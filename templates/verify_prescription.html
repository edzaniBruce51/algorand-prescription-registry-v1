{% extends "base.html" %}
{% block title %}Verify Prescription — Prescription Registry{% endblock %}

{% block content %}
  <section>
    <div class="card">
      <!-- Flash -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form action="/verify_prescription" method="post" class="mt-8">
        <div style="margin-bottom:10px">
          <label for="transactionId">Transaction ID (Required)</label>
          <input id="transactionId" name="transactionId" type="text" value="{{ tx_id or '' }}" required>
        </div>

        <div style="margin-bottom:10px">
          <label for="jsonPayload">JSON Payload (optional)</label>
          <textarea id="jsonPayload" name="jsonPayload" placeholder='{"application":"prescriptionRegistry", "patient_full_name":"Alice Demo", ...}'></textarea>
        </div>

        <div style="margin-bottom:10px">
          <label for="jsonPayloadHash">JSON Payload Hash - Base64 (optional)</label>
          <input id="jsonPayloadHash" name="jsonPayloadHash" type="text" placeholder="Base64 SHA-256 hash">
        </div>

        <div style="display:flex; gap:10px; align-items:center">
          <a href="/" class="btn secondary">← Back</a>
          <button type="submit" class="btn">Verify Prescription</button>
        </div>
      </form>

      {% if result %}
        <div class="list-card mt-8" style="margin-top:14px;">
          <h3>Verification Result</h3>
          <pre style="background:#f7fdfc;padding:12px;border-radius:8px;overflow:auto">{{ result | tojson(indent=2) }}</pre>
        </div>
      {% endif %}
    </div>
  </section>
{% endblock %}

{% block right_column %}
  <div class="list-card">
    <h2>Quick tips</h2>
    <p class="small muted">Use testnet transaction IDs only. For privacy, prefer hashing the prescription JSON and sending the hash on-chain instead of raw PHI.</p>
    <hr style="margin:10px 0">
    <p class="small"><strong>Example:</strong> Provide the tx id and optionally the JSON payload or its SHA-256 base64 hash for verification.</p>
  </div>
{% endblock %}

{% block extra_scripts %}{% endblock %}
