{% extends "base.html" %}
{% block content %}
<style>
  .status-success {
    color: #065f46;
    background: #d1fae5;
    font-weight: bold;
    padding: 8px;
    border-radius: 6px;
  }
  .status-error {
    color: #991b1b;
    background: #fee2e2;
    font-weight: bold;
    padding: 8px;
    border-radius: 6px;
  }
  .radio-inline {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-top: 5px;
  }
  .radio-inline label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }
  .disabled {
    opacity: 0.5;
    pointer-events: none;
  }
</style>

<div class="form-card">
  <h2>Verify Prescription</h2>

  <!-- üîπ Verification Result (replaces old message above Transaction ID) -->
  {% if mode == "post" %}
    {% if result and result.isJsonPayloadHashVerified %}
      {% if tx_type == "hash" %}
        <p class="status-success">‚úÖ Prescription verification successful. Provided data hash (fingerprint) matches on-chain hash.</p>
      {% else %}
        <p class="status-success">‚úÖ Prescription verification successful. Provided data payload matches original data payload.</p>
      {% endif %}
    {% elif result %}
      {% if tx_type == "hash" %}
        <p class="status-error">‚ùå Prescription verification unsuccessful. Provided data hash (fingerprint) does not match on-chain hash.</p>
      {% else %}
        <p class="status-error">‚ùå Prescription verification unsuccessful. Provided data payload does not match original data payload.</p>
      {% endif %}
    {% endif %}
  {% endif %}

  <form method="POST" action="{{ url_for('verify_prescription') }}">
    <label>Transaction ID</label>
    <input type="text" name="transactionId" value="{{ tx_id or '' }}" required>

    <div class="radio-inline">
      <label>
        <input type="radio" name="tx_type" value="payload" onclick="toggleInputs('payload')" checked>
        Payload
      </label>
      <label>
        <input type="radio" name="tx_type" value="hash" onclick="toggleInputs('hash')">
        Hash
      </label>
    </div>

    <label>JSON Payload</label>
    <textarea name="jsonPayload" id="payloadInput"></textarea>

    <label>JSON Payload Hash</label>
    <input type="text" name="jsonPayloadHash" id="hashInput">

    <button type="submit">Verify</button>
  </form>
</div>

<script>
function toggleInputs(selected) {
  document.getElementById("payloadInput").disabled = (selected === "hash");
  document.getElementById("hashInput").disabled = (selected === "payload");
}
toggleInputs("payload"); // default
</script>
{% endblock %}
